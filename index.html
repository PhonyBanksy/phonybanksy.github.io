<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MotorTown Route Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;500;600;700;800&family=Barlow:wght@300;400;500&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
</head>
<body>
<div id="app">

  <!-- â•â• TOPBAR â•â• -->
  <header id="topbar">
    <div class="logo">
      <div class="logo-mark"></div>
      <span class="logo-text">Motor<em>Town</em> Route Editor</span>
    </div>
    <div class="vsep"></div>
    <div class="status-pill">
      <div class="dot"></div>
      <span id="mapStatus">Trying auto-loadâ€¦</span>
    </div>
    <div class="topbar-end">
      <button id="exportZipBtn" class="btn-secondary btn-sm">â¬‡ Export ZIP</button>
      <button id="clearCacheBtn" class="btn-danger btn-sm">âœ• Clear All</button>
    </div>
  </header>

  <!-- â•â• LEFT SIDEBAR â€” Route Tree â•â• -->
  <aside id="sidebar-left">
    <div class="panel-head">
      <span class="panel-title">Routes</span>
    </div>
    <div id="route-tree">
      <div class="sidebar-empty" id="route-empty">
        <div class="e-icon">ðŸ—º</div>
        Import a route JSON to get started
      </div>
    </div>
  </aside>

  <!-- â•â• MAP â•â• -->
  <main id="main">
    <div id="map-toolbar">
      <div class="file-btn-wrap">
        <button id="btnLoadMap" class="btn-secondary btn-sm">ðŸ“‚ Load Map</button>
        <input type="file" id="mapUpload" accept="image/*" />
      </div>
      <div class="vsep"></div>
      <label class="check-wrap"><input type="checkbox" id="reverse" /> Reverse</label>
      <label class="check-wrap"><input type="checkbox" id="boxes" /> Box Waypoints</label>
      <div class="vsep"></div>
      <label class="check-wrap">
        <span style="color:var(--muted);font-size:11px;font-family:var(--head);letter-spacing:.06em;text-transform:uppercase;">Scale</span>
        <select id="scale_mode">
          <option value="1">Ã—1 (none)</option>
          <option value="2">Ã—2</option>
        </select>
      </label>
      <input type="number" id="rotation_angle" value="0" style="display:none;" />
    </div>

    <div id="routeCanvas">
      <div class="map-hint">Scroll to Zoom Â· Drag to Pan Â· Click Waypoint to Select</div>
    </div>
  </main>

  <!-- â•â• RIGHT PANEL â•â• -->
  <aside id="sidebar-right">
    <div class="tabs">
      <button class="tab on" data-pane="pane-process">Process</button>
      <button class="tab" data-pane="pane-json">JSON</button>
    </div>

    <!-- â”€â”€ PROCESS TAB â”€â”€ -->
    <div class="tab-pane on" id="pane-process">

      <!-- INSPECTOR â€” top section, fixed height -->
      <div id="inspector">
        <div class="inspector-head">
          <span class="inspector-title">Inspector</span>
          <span class="inspector-wp-label" id="inspectorWpLabel"></span>
        </div>

        <div class="inspector-select-row">
          <label for="wpSelect">Waypoint</label>
          <select id="wpSelect">
            <option value="-1">â€” no route loaded â€”</option>
          </select>
        </div>

        <div id="inspectorEmpty" class="inspector-empty">
          Click a waypoint on the map<br>or select from the dropdown above
        </div>

        <div id="inspectorBody" class="inspector-body" style="display:none;">
          <div class="insp-row">
            <label>Gate Width (Y)</label>
            <input type="number" id="inpWidth" value="10" step="0.5" />
          </div>
          <div class="insp-row">
            <label>Depth (X)</label>
            <input type="number" id="inpHeight" value="1" step="0.1" />
          </div>
          <div class="insp-row">
            <label>Height (Z)</label>
            <input type="number" id="inpDepth" value="1" step="0.1" />
          </div>
          <div class="insp-rot-val" id="rotateVal">0</div>
          <div class="insp-rot-label">rotation Â°</div>
          <input type="range" id="rotSlider" min="-180" max="180" value="0" />
          <button id="btnSaveWaypoint" class="btn-success btn-full insp-save-btn">ðŸ’¾ Save Changes</button>
        </div>
      </div>

      <!-- SCROLLABLE CONTENT -->
      <div class="process-body">
        <div>
          <div class="sg-title" style="margin-bottom:8px;">How to use</div>
          <p class="step-hint">
            1. Click <strong>Import to Website</strong> to paste your copied route JSON.<br><br>
            2. Set <strong>Scale</strong>, <strong>Box Waypoints</strong>, or <strong>Reverse</strong> in the toolbar.<br><br>
            3. Hit <em>Process Event</em> â€” result appears on the map and in the JSON tab.<br><br>
            4. Click a waypoint on the map (or use the Inspector dropdown above) to edit its properties directly.<br><br>
            5. Click <strong>Export from Website</strong> to copy the output.<br><br>
            6. Each processed variant is saved as a child under the base route in the sidebar, so save after making all changes.
          </p>
        </div>
      </div>

      <!-- ACTION BUTTONS â€” pinned to bottom -->
      <div class="process-footer">
        <button id="importFromWebBtn" class="btn-import btn-full">â¬‡ Import to Website</button>
        <button id="exportToWebBtn"   class="btn-success btn-full">â¬† Export from Website</button>
        <button id="processBtn"       class="btn-primary btn-full">â–¶ Process Event</button>
        <button id="saveCacheBtn"     class="btn-secondary btn-full">ðŸ’¾ Save to Cache</button>
      </div>
    </div>

    <!-- â”€â”€ JSON TAB â”€â”€ -->
    <div class="tab-pane" id="pane-json">
      <div class="json-tab-wrap">
        <div class="json-box">
          <div class="box-header">
            <span class="box-header-label">Input</span>
            <button class="btn-ghost btn-sm" onclick="document.getElementById('json_data').value=''">Clear</button>
          </div>
          <textarea id="json_data" placeholder="Paste your route JSON hereâ€¦"></textarea>
        </div>
        <div class="json-divider"></div>
        <div class="json-box">
          <div class="box-header">
            <span class="box-header-label">Output</span>
            <button class="btn-ghost btn-sm" id="copyOutputBtn">Copy</button>
          </div>
          <textarea id="output" placeholder="Processed output will appear hereâ€¦" style="color:#ce9178;"></textarea>
        </div>
      </div>
    </div>

  </aside>
</div>

<div id="toast">Done!</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="math-utils.js"></script>
<script src="route-processor.js"></script>
<script src="map-visualizer.js"></script>
<script src="inspector.js"></script>
<script src="main.js"></script>
<script src="main-overrides.js"></script>

</body>
</html>
