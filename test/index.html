<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MotorTown Route Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;500;600;700;800&family=Barlow:wght@300;400;500&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:      #0b0c0e;
      --surface: #13151a;
      --panel:   #1a1d24;
      --border:  #22262f;
      --border2: #2c3140;
      --accent:  #e8400c;
      --text:    #cdd1de;
      --muted:   #4e5568;
      --green:   #27c26b;
      --blue:    #00bfff;
      --mono:    'Share Tech Mono', monospace;
      --head:    'Barlow Condensed', sans-serif;
      --body:    'Barlow', sans-serif;
    }

    html, body { height: 100%; background: var(--bg); color: var(--text); font-family: var(--body); font-size: 13px; overflow: hidden; }

    /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
    #app { display: grid; grid-template-columns: 230px 1fr 310px; grid-template-rows: 48px 1fr; height: 100vh; }

    /* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
    #topbar {
      grid-column: 1/-1; display: flex; align-items: center; gap: 14px;
      padding: 0 14px; background: var(--surface); border-bottom: 1px solid var(--border); z-index: 20;
    }
    .logo { display: flex; align-items: center; gap: 8px; }
    .logo-mark { width: 22px; height: 22px; background: var(--accent); clip-path: polygon(25% 0%,100% 0%,75% 100%,0% 100%); flex-shrink:0; }
    .logo-text { font-family: var(--head); font-size: 16px; font-weight: 800; letter-spacing: .07em; text-transform: uppercase; }
    .logo-text em { color: var(--accent); font-style: normal; }
    .vsep { width: 1px; height: 20px; background: var(--border2); flex-shrink: 0; }
    .status-pill { display: flex; align-items: center; gap: 5px; font-family: var(--mono); font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: .07em; }
    .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); box-shadow: 0 0 7px var(--green); animation: pulse 2.4s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }
    .topbar-end { margin-left: auto; display: flex; gap: 6px; }

    /* ‚îÄ‚îÄ LEFT SIDEBAR ‚îÄ‚îÄ */
    #sidebar-left { background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; }
    .panel-head { padding: 10px 12px 8px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
    .panel-title { font-family: var(--head); font-size: 10px; font-weight: 700; letter-spacing: .15em; text-transform: uppercase; color: var(--muted); }

    /* ‚îÄ‚îÄ HIERARCHICAL ROUTE TREE ‚îÄ‚îÄ */
    #route-tree { flex: 1; overflow-y: auto; padding: 6px; }
    #route-tree::-webkit-scrollbar { width: 3px; }
    #route-tree::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

    .route-group { margin-bottom: 4px; }

    .route-parent {
      display: flex; align-items: center; gap: 0; padding: 0;
      border-radius: 4px; border: 1px solid var(--border2); overflow: hidden;
      transition: border-color .15s;
    }
    .route-parent:hover { border-color: var(--muted); }
    .route-parent.active { border-color: rgba(232,64,12,.5); background: rgba(232,64,12,.06); }

    .route-parent-load {
      flex: 1; display: flex; align-items: center; gap: 8px;
      padding: 8px 10px; cursor: pointer; background: none; border: none;
      color: var(--text); font-family: var(--body); font-size: 12px; font-weight: 500;
      text-align: left; min-width: 0;
    }
    .route-parent-load:hover { background: rgba(255,255,255,.03); }
    .route-icon { font-size: 13px; flex-shrink: 0; }
    .route-parent-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .route-collapse-btn {
      padding: 8px 9px; background: none; border: none; border-left: 1px solid var(--border2);
      color: var(--muted); font-size: 11px; cursor: pointer; flex-shrink: 0; transition: all .15s;
      line-height: 1;
    }
    .route-collapse-btn:hover { color: var(--text); background: rgba(255,255,255,.04); filter: none; }

    .route-delete-btn {
      padding: 8px 8px; background: none; border: none; border-left: 1px solid var(--border2);
      color: var(--muted); font-size: 13px; cursor: pointer; flex-shrink: 0; transition: color .15s;
      line-height: 1;
    }
    .route-delete-btn:hover { color: #e05050; filter: none; }

    .route-children { padding-left: 14px; margin-top: 3px; display: flex; flex-direction: column; gap: 2px; }
    .route-children.collapsed { display: none; }

    .route-child {
      display: flex; align-items: center; gap: 0;
      border-radius: 3px; border: 1px solid var(--border); overflow: hidden;
      transition: border-color .15s;
    }
    .route-child:hover { border-color: var(--border2); }
    .route-child.active { border-color: rgba(232,64,12,.4); background: rgba(232,64,12,.05); }

    .route-child-load {
      flex: 1; display: flex; align-items: center; gap: 7px;
      padding: 6px 9px; cursor: pointer; background: none; border: none;
      color: var(--text); font-family: var(--mono); font-size: 10px;
      text-align: left; min-width: 0;
    }
    .route-child-load:hover { background: rgba(255,255,255,.03); }
    .child-label { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--muted); }
    .route-child.active .child-label { color: var(--text); }

    .route-child-delete {
      padding: 6px 7px; background: none; border: none; border-left: 1px solid var(--border);
      color: var(--muted); font-size: 12px; cursor: pointer; flex-shrink: 0; transition: color .15s;
      line-height: 1;
    }
    .route-child-delete:hover { color: #e05050; filter: none; }

    .sidebar-empty { padding: 20px 12px; text-align: center; color: var(--muted); font-size: 11px; line-height: 1.7; }
    .sidebar-empty .e-icon { font-size: 28px; margin-bottom: 8px; opacity: .4; }

    /* ‚îÄ‚îÄ MAIN MAP ‚îÄ‚îÄ */
    #main { display: flex; flex-direction: column; background: var(--bg); overflow: hidden; }

    #map-toolbar {
      display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
      padding: 7px 12px; border-bottom: 1px solid var(--border); background: var(--surface); flex-shrink: 0;
    }

    #routeCanvas {
      flex: 1; position: relative; overflow: hidden; cursor: crosshair;
      background:
        repeating-linear-gradient(0deg,transparent,transparent 29px,rgba(34,38,47,.5) 29px,rgba(34,38,47,.5) 30px),
        repeating-linear-gradient(90deg,transparent,transparent 29px,rgba(34,38,47,.5) 29px,rgba(34,38,47,.5) 30px),
        radial-gradient(ellipse at 35% 45%,rgba(232,64,12,.04) 0%,transparent 65%),
        var(--bg);
    }
    #routeCanvas canvas { display: block; width: 100%; height: 100%; }
    .map-hint {
      position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%);
      font-family: var(--mono); font-size: 10px; color: var(--muted);
      background: rgba(11,12,14,.8); border: 1px solid var(--border2);
      padding: 4px 12px; border-radius: 20px; pointer-events: none; white-space: nowrap; z-index: 5;
    }

    /* ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ */
    #sidebar-right { background: var(--surface); border-left: 1px solid var(--border); border-top: 2px solid var(--accent); display: flex; flex-direction: column; overflow: hidden; }

    .tabs { display: grid; grid-template-columns: 1fr 1fr; border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .tab {
      padding: 10px 0; font-family: var(--head); font-size: 11px; font-weight: 700;
      letter-spacing: .12em; text-transform: uppercase; color: var(--muted);
      background: none; border: none; border-bottom: 2px solid transparent; cursor: pointer; transition: all .15s;
    }
    .tab:hover { color: var(--text); filter: none; }
    .tab.on { color: var(--accent); border-bottom-color: var(--accent); }

    .tab-pane { display: none; flex-direction: column; flex: 1; overflow: hidden; }
    .tab-pane.on { display: flex; }

    /* Process tab */
    .s-scroll { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 14px; }
    .sg-title { font-family: var(--head); font-size: 10px; font-weight: 700; letter-spacing: .14em; text-transform: uppercase; color: var(--muted); padding-bottom: 6px; border-bottom: 1px solid var(--border); margin-bottom: 2px; }
    .step-hint { font-size: 11px; color: var(--muted); line-height: 1.75; }
    .step-hint strong { color: var(--text); }
    .step-hint em { color: var(--accent); font-style: normal; }

    /* JSON tab */
    .json-box { flex: 1; display: flex; flex-direction: column; min-height: 0; position: relative; }
    .box-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px 5px; flex-shrink: 0; }
    .box-header-label { font-family: var(--head); font-size: 10px; font-weight: 700; letter-spacing: .14em; text-transform: uppercase; color: var(--muted); }
    .json-divider { height: 1px; background: var(--border); flex-shrink: 0; }

    textarea {
      flex: 1; background: var(--bg); border: none; border-top: 1px solid var(--border);
      color: #ce9178; font-family: var(--mono); font-size: 11px;
      padding: 10px 12px; resize: none; outline: none; line-height: 1.65; transition: border-color .15s;
    }
    textarea:focus { border-color: rgba(232,64,12,.35); }
    textarea::placeholder { color: var(--muted); }

    /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
    button {
      display: inline-flex; align-items: center; justify-content: center; gap: 5px;
      padding: 6px 13px; font-family: var(--head); font-size: 11px; font-weight: 700;
      letter-spacing: .08em; text-transform: uppercase;
      border: none; border-radius: 3px; cursor: pointer; transition: all .15s; white-space: nowrap;
    }
    button:hover { filter: brightness(1.12); }
    .btn-primary  { background: var(--accent); color: #fff; }
    .btn-primary:hover  { background: #f04a1e; box-shadow: 0 3px 14px rgba(232,64,12,.3); filter: none; }
    .btn-secondary { background: var(--panel); color: var(--text); border: 1px solid var(--border2); }
    .btn-secondary:hover { background: var(--border2); filter: none; }
    .btn-ghost  { background: transparent; color: var(--muted); border: 1px solid transparent; }
    .btn-ghost:hover { background: var(--panel); color: var(--text); filter: none; }
    .btn-danger { background: transparent; color: #d95050; border: 1px solid rgba(217,80,80,.3); }
    .btn-danger:hover { background: rgba(217,80,80,.1); border-color: #d95050; filter: none; }
    .btn-success { background: #1c5230; color: #4cdd8a; border: 1px solid #245e38; }
    .btn-success:hover { background: #226040; filter: none; }
    .btn-import { background: #1a2c4a; color: #5aacf5; border: 1px solid #274470; }
    .btn-import:hover { background: #1e3358; filter: none; }
    .btn-full { width: 100%; }
    .btn-sm { padding: 4px 10px; font-size: 10px; }

    /* ‚îÄ‚îÄ FORM CONTROLS ‚îÄ‚îÄ */
    select {
      background: var(--panel); color: var(--text); border: 1px solid var(--border2);
      border-radius: 3px; padding: 5px 26px 5px 8px; font-family: var(--body); font-size: 12px;
      cursor: pointer; outline: none; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%234e5568'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 8px center;
    }
    select:focus { border-color: rgba(232,64,12,.5); outline: none; }

    .check-wrap { display: flex; align-items: center; gap: 7px; font-size: 12px; cursor: pointer; user-select: none; white-space: nowrap; }
    .check-wrap input[type=checkbox] {
      appearance: none; -webkit-appearance: none; width: 15px; height: 15px;
      border: 1px solid var(--border2); border-radius: 3px; background: var(--panel);
      cursor: pointer; flex-shrink: 0; transition: all .15s; position: relative;
    }
    .check-wrap input[type=checkbox]:checked { background: var(--accent); border-color: var(--accent); }
    .check-wrap input[type=checkbox]:checked::after {
      content: '‚úì'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
      font-size: 10px; color: #fff; font-weight: 900;
    }

    input[type=number] {
      background: var(--panel); color: var(--text); border: 1px solid var(--border2);
      border-radius: 3px; padding: 5px 8px; font-family: var(--mono); font-size: 12px;
      outline: none; width: 62px;
    }
    input[type=number]:focus { border-color: rgba(232,64,12,.5); }
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }

    input[type=range] { -webkit-appearance: none; width: 100%; height: 4px; border-radius: 2px; background: var(--border2); outline: none; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%; background: var(--blue); cursor: pointer; box-shadow: 0 0 8px rgba(0,191,255,.4); }

    .file-btn-wrap { position: relative; display: inline-flex; }
    .file-btn-wrap input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; }

    /* loading overlay used by route-processor.js */
    .loading-overlay {
      position: absolute; inset: 0; background: rgba(0,0,0,.55);
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; color: #fff; z-index: 10;
    }

    #mapStatus { font-family: var(--mono); font-size: 10px; color: var(--muted); }

    @keyframes blink-anim { 0%,100%{filter:brightness(1);transform:scale(1)} 50%{filter:brightness(1.9);transform:scale(1.04)} }
    .blink-active { animation: blink-anim .4s ease-in-out; }

    /* Sidebar item blink when saved */
    @keyframes sidebar-blink-anim {
      0%   { background: rgba(232,64,12,.09); box-shadow: none; }
      35%  { background: rgba(39,194,107,.25); box-shadow: 0 0 10px rgba(39,194,107,.4); }
      70%  { background: rgba(39,194,107,.15); box-shadow: 0 0 6px rgba(39,194,107,.2); }
      100% { background: rgba(232,64,12,.09); box-shadow: none; }
    }
    .sidebar-blink { animation: sidebar-blink-anim .6s ease-out !important; }

    /* ‚îÄ‚îÄ WAYPOINT CONTEXT MENU ‚îÄ‚îÄ */
    #wpContext {
      position: fixed; display: none;
      background: var(--panel); border: 1px solid var(--border2);
      box-shadow: 0 10px 36px rgba(0,0,0,.7); border-radius: 5px;
      width: 210px; z-index: 200;
    }
    .menu-header {
      background: var(--surface); padding: 8px 10px;
      font-family: var(--head); font-size: 11px; font-weight: 700; letter-spacing: .08em; text-transform: uppercase;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid var(--border2); border-radius: 5px 5px 0 0;
    }
    .close-menu { cursor: pointer; font-size: 16px; color: var(--muted); line-height: 1; padding: 0 2px; }
    .close-menu:hover { color: var(--text); }
    .menu-body { padding: 10px; display: flex; flex-direction: column; gap: 7px; }
    #wpMainOpts { display: flex; flex-direction: column; gap: 5px; }
    #wpAdjustPanel, #wpRotatePanel { display: none; flex-direction: column; gap: 8px; }
    .input-row { display: flex; justify-content: space-between; align-items: center; font-size: 12px; }
    .input-row input { width: 68px; }
    .rotate-readout { text-align: center; font-family: var(--mono); font-size: 24px; font-weight: 700; color: var(--blue); padding: 4px 0; }
    .rotate-label { text-align: center; font-family: var(--head); font-size: 10px; letter-spacing: .1em; text-transform: uppercase; color: var(--muted); margin-top: -2px; margin-bottom: 4px; }

    /* toast notification */
    #toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: #1c5230; color: #4cdd8a; border: 1px solid #245e38;
      font-family: var(--head); font-size: 12px; font-weight: 700; letter-spacing: .08em; text-transform: uppercase;
      padding: 8px 18px; border-radius: 4px; z-index: 999; opacity: 0; transition: all .25s ease; pointer-events: none;
    }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>
<div id="app">

  <!-- TOPBAR -->
  <header id="topbar">
    <div class="logo">
      <div class="logo-mark"></div>
      <span class="logo-text">Motor<em>Town</em> Route Editor</span>
    </div>
    <div class="vsep"></div>
    <div class="status-pill"><div class="dot"></div><span id="mapStatus">Trying auto-load‚Ä¶</span></div>
    <div class="topbar-end">
      <button id="exportZipBtn" class="btn-secondary btn-sm">‚¨á Export ZIP</button>
      <button id="clearCacheBtn" class="btn-danger btn-sm">‚úï Clear All</button>
    </div>
  </header>

  <!-- LEFT SIDEBAR -->
  <aside id="sidebar-left">
    <div class="panel-head">
      <span class="panel-title">Routes</span>
    </div>
    <!-- Hierarchical tree built by main-overrides.js -->
    <div id="route-tree">
      <div class="sidebar-empty" id="route-empty">
        <div class="e-icon">üó∫</div>
        Import a route JSON to get started
      </div>
    </div>
  </aside>

  <!-- MAP -->
  <main id="main">
    <div id="map-toolbar">
      <div class="file-btn-wrap">
        <button id="btnLoadMap" class="btn-secondary btn-sm">üìÇ Load Map</button>
        <input type="file" id="mapUpload" accept="image/*" />
      </div>
      <div class="vsep"></div>
      <label class="check-wrap"><input type="checkbox" id="reverse" /> Reverse</label>
      <label class="check-wrap"><input type="checkbox" id="boxes" /> Box Waypoints</label>
      <div class="vsep"></div>
      <label class="check-wrap">
        <span style="color:var(--muted);font-size:11px;font-family:var(--head);letter-spacing:.06em;text-transform:uppercase;">Scale</span>
        <select id="scale_mode">
          <option value="1">√ó1 (none)</option>
          <option value="1.5">√ó1.5</option>
          <option value="2">√ó2</option>
          <option value="3">√ó3</option>
          <option value="0.5">√ó0.5</option>
          <option value="0.75">√ó0.75</option>
        </select>
      </label>
      <label class="check-wrap">
        <span style="color:var(--muted);font-size:11px;font-family:var(--head);letter-spacing:.06em;text-transform:uppercase;">Rotate¬∞</span>
        <input type="number" id="rotation_angle" value="0" />
      </label>
    </div>

    <div id="routeCanvas">
      <div class="map-hint">Scroll to Zoom ¬∑ Drag to Pan ¬∑ Click Waypoint to Edit</div>
    </div>
  </main>

  <!-- RIGHT PANEL -->
  <aside id="sidebar-right">
    <div class="tabs">
      <button class="tab on" data-pane="pane-process">Process</button>
      <button class="tab" data-pane="pane-json">JSON</button>
    </div>

    <!-- PROCESS TAB -->
    <div class="tab-pane on" id="pane-process">
      <div class="s-scroll">
        <div>
          <div class="sg-title">Import / Export</div>
          <div style="display:flex;flex-direction:column;gap:5px;margin-top:8px;">
            <button id="importFromWebBtn" class="btn-import btn-full">‚¨á Import from Website</button>
            <button id="exportToWebBtn" class="btn-success btn-full">‚¨Ü Export to Website</button>
          </div>
        </div>
        <div>
          <div class="sg-title">Process</div>
          <div style="display:flex;flex-direction:column;gap:5px;margin-top:8px;">
            <button id="processBtn" class="btn-primary btn-full">‚ñ∂ Process Batch</button>
            <button id="saveCacheBtn" class="btn-secondary btn-full">üíæ Save to Cache</button>
          </div>
        </div>
        <div>
          <div class="sg-title" style="margin-bottom:8px;">How to use</div>
          <p class="step-hint">
            1. Click <strong>Import from Website</strong> to paste your copied route JSON.<br><br>
            2. Set <strong>Scale</strong> (multiplies gate width), <strong>Box Waypoints</strong> (adds proportional post thickness), <strong>Reverse</strong>, or <strong>Rotate¬∞</strong> in the toolbar.<br><br>
            3. Hit <em>Process Batch</em> ‚Äî the result appears on the map and in the JSON tab.<br><br>
            4. Click <strong>Export to Website</strong> to copy the output.<br><br>
            5. Each processed variant is saved as a child under the base route in the sidebar.
          </p>
        </div>
      </div>
    </div>

    <!-- JSON TAB (kept for power users) -->
    <div class="tab-pane" id="pane-json">
      <div class="json-box">
        <div class="box-header">
          <span class="box-header-label">Input</span>
          <button class="btn-ghost btn-sm" onclick="document.getElementById('json_data').value=''">Clear</button>
        </div>
        <textarea id="json_data" placeholder="Paste your route JSON here‚Ä¶"></textarea>
      </div>
      <div class="json-divider"></div>
      <div class="json-box">
        <div class="box-header">
          <span class="box-header-label">Output</span>
          <button class="btn-ghost btn-sm" id="copyOutputBtn">Copy</button>
        </div>
        <textarea id="output" placeholder="Processed output will appear here‚Ä¶" style="color:#ce9178;"></textarea>
      </div>
    </div>
  </aside>

</div>

<!-- WAYPOINT CONTEXT MENU -->
<div id="wpContext">
  <div class="menu-header">
    <span id="wpTitle">Waypoint</span>
    <span class="close-menu" onclick="window.closeMenu && window.closeMenu()">√ó</span>
  </div>
  <div class="menu-body">
    <div id="wpMainOpts">
      <button id="btnOptAdjust" class="btn-secondary btn-full">‚áî Adjust Size</button>
      <button id="btnOptRotate" class="btn-secondary btn-full">‚Üª Rotate</button>
    </div>
    <div id="wpAdjustPanel">
      <div class="input-row"><span>Gate Width (Y)</span> <input type="number" id="inpWidth"  value="10" /></div>
      <div class="input-row"><span>Depth (X)</span>       <input type="number" id="inpHeight" value="1"  /></div>
      <div class="input-row"><span>Height (Z)</span>      <input type="number" id="inpDepth"  value="1"  /></div>
      <button id="btnSaveWaypoint" class="btn-success btn-full" style="margin-top:4px;">üíæ Save Changes</button>
      <button id="btnBackAdjust" class="btn-ghost btn-full">‚Üê Back</button>
    </div>
    <div id="wpRotatePanel">
      <div class="rotate-readout" id="rotateVal">0</div>
      <div class="rotate-label">degrees</div>
      <input type="range" id="rotSlider" min="-180" max="180" value="0" />
      <button id="btnBackRotate" class="btn-ghost btn-full">‚Üê Back</button>
    </div>
  </div>
</div>

<div id="toast">Copied!</div>

<script>
  /* ‚îÄ‚îÄ TAB SWITCHING ‚îÄ‚îÄ */
  document.querySelectorAll('.tab').forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.dataset.pane;
      document.querySelectorAll('.tab').forEach(b => b.classList.remove('on'));
      document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('on'));
      btn.classList.add('on');
      document.getElementById(target).classList.add('on');
    });
  });

  /* ‚îÄ‚îÄ ROTATION SLIDER LIVE ‚îÄ‚îÄ */
  document.getElementById('rotSlider').addEventListener('input', function() {
    document.getElementById('rotateVal').textContent = this.value;
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="math-utils.js"></script>
<script src="route-processor.js"></script>
<script src="map-visualizer.js"></script>
<script src="waypoint-ui.js"></script>
<script src="main.js"></script>

<!-- main-overrides.js: loads last, overrides route list with hierarchical tree,
     fixes clipboard, wires Import/Export buttons -->
<script src="main-overrides.js"></script>

</body>
</html>
